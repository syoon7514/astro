import streamlit as st
import numpy as np
import matplotlib.pyplot as plt

st.title("ğŸŒŒ ì€í•˜ íšŒì „ ê³¡ì„  ì‹œë®¬ë ˆì´í„°")
st.markdown("""
ì´ ì‹œë®¬ë ˆì´í„°ëŠ” ì€í•˜ ë‚´ ë³„ë“¤ì˜ ê³µì „ ì†ë„ë¥¼ ë°˜ì§€ë¦„ì— ë”°ë¼ ë‚˜íƒ€ë‚¸ ê·¸ë˜í”„ë¥¼ í†µí•´, ì•”í‘ë¬¼ì§ˆì˜ ì¡´ì¬ ê°€ëŠ¥ì„±ì„ ì‹œê°ì ìœ¼ë¡œ ë³´ì—¬ì¤ë‹ˆë‹¤.
""")

# -----------------------------
# 1. ì…ë ¥ ë°ì´í„° ì„¤ì •
# -----------------------------
st.header("ğŸ”§ ë°˜ì§€ë¦„-ì†ë„ ë°ì´í„° ì„¤ì •")

default_r = np.linspace(0.1, 20, 100)
default_v_obs = np.concatenate([
    np.sqrt(default_r[:30] * 50),
    np.full(70, np.sqrt(30 * 50))
])

# ì‚¬ìš©ì ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ
r = st.slider("ë°˜ì§€ë¦„ ë²”ìœ„ (kpc)", 5, 50, 20)
mass_distribution = st.selectbox("ì§ˆëŸ‰ ë¶„í¬ ê°€ì •", ["êµ¬í˜• ë¶„í¬ (MâˆrÂ³)", "ê· ë“± ë¶„í¬ (Mâˆr)"])

r_vals = np.linspace(0.1, r, 100)

# -----------------------------
# 2. ë‰´í„´ ì˜ˆì¸¡ ì†ë„ ê³„ì‚°
# -----------------------------
G = 4.3e-6  # kpc (km/s)^2 / Msun, ì€í•˜ ë‹¨ìœ„ì— ë§ì¶˜ ì¤‘ë ¥ìƒìˆ˜
if mass_distribution == "êµ¬í˜• ë¶„í¬ (MâˆrÂ³)":
    M = r_vals ** 3
else:
    M = r_vals

v_newton = np.sqrt(G * M / r_vals)

# -----------------------------
# 3. ê´€ì¸¡ ì†ë„ ì„¤ì • (í”Œë«í•œ ì†ë„ ê³¡ì„ )
# -----------------------------
# ê´€ì¸¡ ì†ë„ëŠ” r=5kpc ì´í›„ë¶€í„°ëŠ” í‰í‰í•œ ì†ë„ ìœ ì§€
v_obs = np.concatenate([
    np.sqrt(r_vals[:30] * 50),
    np.full(len(r_vals) - 30, np.sqrt(30 * 50))
])

# -----------------------------
# 4. ì‹œê°í™”
# -----------------------------
st.header("ğŸ“Š íšŒì „ ê³¡ì„  ê·¸ë˜í”„")

fig, ax = plt.subplots()
ax.plot(r_vals, v_newton, label="ì˜ˆì¸¡ ì†ë„ (ë‰´í„´ ì—­í•™)", linestyle='--')
ax.plot(r_vals, v_obs, label="ê´€ì¸¡ ì†ë„", linestyle='-')
ax.set_xlabel("ë°˜ì§€ë¦„ (kpc)")
ax.set_ylabel("ê³µì „ ì†ë„ (km/s)")
ax.set_title("ì€í•˜ íšŒì „ ê³¡ì„  ë¹„êµ")
ax.legend()
st.pyplot(fig)

# -----------------------------
# 5. í•´ì„¤
# -----------------------------
st.header("ğŸ“š í•´ì„¤")
st.markdown("""
- ë‰´í„´ ì—­í•™ì— ë”°ë¥´ë©´ ì¤‘ì‹¬ ì§ˆëŸ‰ ë¶„í¬ë§Œì„ ê³ ë ¤í–ˆì„ ë•Œ ë³„ì˜ ì†ë„ëŠ” ë°˜ì§€ë¦„ì— ë”°ë¼ **ê°ì†Œ**í•´ì•¼ í•©ë‹ˆë‹¤.
- ê·¸ëŸ¬ë‚˜ ì‹¤ì œ ê´€ì¸¡ëœ ì†ë„ëŠ” **ì¼ì •í•˜ê²Œ ìœ ì§€**ë©ë‹ˆë‹¤.
- ì´ëŠ” ì¤‘ì‹¬ ì™¸ê³½ì— **ê´€ì¸¡ë˜ì§€ ì•ŠëŠ” ì§ˆëŸ‰(ì•”í‘ë¬¼ì§ˆ)** ì´ ì¡´ì¬í•¨ì„ ì‹œì‚¬í•©ë‹ˆë‹¤.
""")
